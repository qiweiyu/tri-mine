window.__require=function t(i,s,e){function n(h,a){if(!s[h]){if(!i[h]){var r=h.split("/");if(r=r[r.length-1],!i[r]){var l="function"==typeof __require&&__require;if(!a&&l)return l(r,!0);if(o)return o(r,!0);throw new Error("Cannot find module '"+h+"'")}h=r}var u=s[h]={exports:{}};i[h][0].call(u.exports,function(t){return n(i[h][1][t]||t)},u,u.exports,t,i,s,e)}return s[h].exports}for(var o="function"==typeof __require&&__require,h=0;h<e.length;h++)n(e[h]);return n}({Game:[function(t,i,s){"use strict";cc._RF.push(i,"280c3rsZJJKnZ9RqbALVwtK","Game"),cc.Class({extends:cc.Component,properties:{playGroundNode:cc.Node,settingPanel:cc.Node,timerLabel:cc.Label,countLabel:cc.Label,widthSettingBox:cc.Node,heightSettingBox:cc.Node,mineSettingBox:cc.Node},onLoad:function(){this.playGround=this.playGroundNode.getComponent("PlayGround"),this.status=this.node.getComponent("Status"),this.mine=this.node.getComponent("Mine"),this.width=15,this.height=10,this.mineCount=20,this.timer=0,this.findCount=0},start:function(){this.newGame()},update:function(t){this.setCountLabel(),this.setTimerLabel(t)},newGame:function(){this.timer=0,this.findCount=0,this.wallStatus=[],this.symbolStatus=[];for(var t=0;t<this.height;t++){this.wallStatus[t]=[],this.symbolStatus[t]=[];for(var i=0;i<this.width;i++)this.wallStatus[t][i]=!1,this.symbolStatus[t][i]=this.playGround.symbolIndex.NULL}this.playGround.reset(this.width,this.height),this.status.setReady()},startGame:function(t){this.status.setRun(),this.mine.generate(this.width,this.height,this.mineCount,t),this.timer=0,this.findCount=0},checkEndGame:function(){if(this.status.isRun()){var t=0;this.wallStatus.forEach(function(i){return i.forEach(function(i){return t+=Number(!i)})}),t===this.mineCount&&this.status.setSucc()}},openSetting:function(){this.status.pause(),this.settingPanel.setPosition(0,0),this.widthSettingBox.getComponent(cc.EditBox).string=this.width,this.heightSettingBox.getComponent(cc.EditBox).string=this.height,this.mineSettingBox.getComponent(cc.EditBox).string=this.mineCount},closeSetting:function(){this.status.resume(),this.settingPanel.setPosition(0,1e3)},formatSetting:function(t,i,s){var e=Number(t);return isNaN(e)?null:Math.min(s,Math.max(i,e))},saveSetting:function(){var t=this.formatSetting(this.widthSettingBox.getComponent(cc.EditBox).string,1,30),i=this.formatSetting(this.heightSettingBox.getComponent(cc.EditBox).string,1,30);if(null===t&&(this.widthSettingBox.getComponent(cc.EditBox).string="error"),null===i&&(this.heightSettingBox.getComponent(cc.EditBox).string="error"),t&&i){var s=this.formatSetting(this.mineSettingBox.getComponent(cc.EditBox).string,1,Math.ceil(t*i/2));s?(this.width=t,this.height=i,this.mineCount=s,this.newGame(),this.closeSetting()):this.mineSettingBox.getComponent(cc.EditBox).string="error"}},cancelSetting:function(){this.closeSetting()},openWall:function(t){var i=this;if(!this.wallStatus[t.y][t.x]&&this.symbolStatus[t.y][t.x]!==this.playGround.symbolIndex.FLAG){if(this.wallStatus[t.y][t.x]=!0,this.mine.isMine(t))return this.symbolStatus[t.y][t.x]=this.playGround.symbolIndex.BOOM,void this.status.setFail();var s=this.mine.roundPos(t.x,t.y,this.width,this.height),e=0;s.forEach(function(t){return e+=Number(i.mine.isMine(t))}),0===e?(this.symbolStatus[t.y][t.x]=this.playGround.symbolIndex.NULL,s.forEach(function(t){return i.openWall(t)})):this.symbolStatus[t.y][t.x]=e}},onGroundRightClick:function(t){if(!this.wallStatus[t.y][t.x]){var i;switch(this.status.isReady()&&this.startGame(t),this.symbolStatus[t.y][t.x]){case this.playGround.symbolIndex.NULL:i=this.playGround.symbolIndex.FLAG,this.findCount++;break;case this.playGround.symbolIndex.FLAG:i=this.playGround.symbolIndex.QUES,this.findCount--;break;default:i=this.playGround.symbolIndex.NULL}this.symbolStatus[t.y][t.x]=i,this.playGround.render(this.wallStatus,this.symbolStatus)}},onGroundLeftClick:function(t){this.wallStatus[t.y][t.x]||this.symbolStatus[t.y][t.x]===this.playGround.symbolIndex.NULL&&(this.status.isReady()&&this.startGame(t),this.openWall(t),this.playGround.render(this.wallStatus,this.symbolStatus),this.checkEndGame())},onGroundLeftDoubleClick:function(t){var i=this;if(this.wallStatus[t.y][t.x]){var s=this.symbolStatus[t.y][t.x];if(0!==s){var e=this.mine.roundPos(t.x,t.y,this.width,this.height),n=0;e.forEach(function(t){return n+=Number(i.symbolStatus[t.y][t.x]===i.playGround.symbolIndex.FLAG)}),n===s&&e.forEach(function(t){i.symbolStatus[t.y][t.x]!==i.playGround.symbolIndex.FLAG&&i.openWall(t)}),this.playGround.render(this.wallStatus,this.symbolStatus),this.checkEndGame()}}},setCountLabel:function(){var t=this.mineCount-this.findCount,i="";i=t<0?"-"+Math.abs(t).toString().padStart(3,0):t.toString().padStart(4,0),this.countLabel.string=i},setTimerLabel:function(t){this.status.isRun()&&(this.timer=this.timer+t),this.timerLabel.string=this.timer.toFixed(4).padStart(9,0)}}),cc._RF.pop()},{}],Mine:[function(t,i,s){"use strict";cc._RF.push(i,"a80f1XBFiJFIp7t83gs0SsO","Mine"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){this.mineMap=[]},isMine:function(t){return this.mineMap[t.y][t.x]},reset:function(){this.mineMap=[]},generate:function(t,i,s){var e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=[],o=0;do{n=this.tryGenerate(t,i,s,e),o++}while(!this.checkValid(n,t,i)&&o<t*i);this.mineMap=n},tryGenerate:function(t,i,s){for(var e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=[],o=0;o<i;o++){n[o]=[];for(var h=0;h<t;h++)n[o][h]=!1}for(var a=0;a<s;a++){var r=void 0,l=void 0;do{r=Math.floor(Math.random()*i),l=Math.floor(Math.random()*t)}while(n[r][l]||e&&r===e.y&&l===e.x);n[r][l]=!0}return n},checkValid:function(t,i,s){for(var e=0;e<s;e++)for(var n=0;n<i;n++)if(t[e][n]){var o=this.roundPos(n,e,i,s),h=0;if(o.forEach(function(i){return h+=Number(t[i.y][i.x])}),h===o.length)return!1}return!0},roundPos:function(t,i,s,e){var n=[];return(t+i)%2==0?(n.push({x:t-2,y:i+1}),n.push({x:t-1,y:i+1}),n.push({x:t,y:i+1}),n.push({x:t+1,y:i+1}),n.push({x:t+2,y:i+1}),n.push({x:t-2,y:i}),n.push({x:t-1,y:i}),n.push({x:t+1,y:i}),n.push({x:t+2,y:i}),n.push({x:t-1,y:i-1}),n.push({x:t,y:i-1}),n.push({x:t+1,y:i-1})):(n.push({x:t-1,y:i+1}),n.push({x:t,y:i+1}),n.push({x:t+1,y:i+1}),n.push({x:t-2,y:i}),n.push({x:t-1,y:i}),n.push({x:t+1,y:i}),n.push({x:t+2,y:i}),n.push({x:t-2,y:i-1}),n.push({x:t-1,y:i-1}),n.push({x:t,y:i-1}),n.push({x:t+1,y:i-1}),n.push({x:t+2,y:i-1})),n.filter(function(t){return t.x>=0&&t.y>=0&&t.x<s&&t.y<e})}}),cc._RF.pop()},{}],PlayGround:[function(t,i,s){"use strict";cc._RF.push(i,"5a7367KVLFKLoo46smTeq1b","PlayGround");var e={CC:0,CO:1,OO:2,CE:3,OE:4},n={NULL:-1,QUES:0,FLAG:13,BOOM:14};cc.Class({extends:cc.Component,properties:{wallSF:{default:[],type:[cc.SpriteFrame]},symbolSF:{default:[],type:[cc.SpriteFrame]}},ctor:function(){this.symbolIndex=n},onLoad:function(){this.paddingTop=100,this.paddingBottom=20,this.padding=100,this.game=this.node.parent.getComponent("Game"),this.wallPool=new cc.NodePool,this.symbolPool=new cc.NodePool,this.node.on(cc.Node.EventType.MOUSE_DOWN,this.onMouseDown,this),this.node.setPosition(0,(this.paddingBottom-this.paddingTop)/2)},reset:function(t,i){var s=this;this.wallSpList&&this.wallSpList.forEach(function(t){return t.forEach(function(t){return s.wallPool.put(t.node)})}),this.symbolSpList&&this.symbolSpList.forEach(function(t){return t.forEach(function(t){return t&&s.rmSymbol(t.node)})}),this.width=t,this.height=i;var e=this.node.parent,n=(e.width-2*this.padding)/t,o=(e.height-this.paddingBottom-this.paddingTop)/i;this.unit=Math.min(n,o);var h=this.unit/128,a=.6*h;this.wallWidth=128*a,this.wallHeight=128*h,this.symbolScale=this.unit/256*.5,this.wallSpList=[],this.symbolSpList=[];for(var r=0;r<this.height;r++){this.wallSpList[r]=[],this.symbolSpList[r]=[];for(var l=0;l<this.width+1;l++){var u=void 0;switch(l){case 0:u="EC";break;case this.width:u="CE";break;default:u="CC"}var c=this.wallPool.get();null===c&&(c=new cc.Node(cc.Sprite)).addComponent(cc.Sprite),c.parent=this.node,c.setPosition((l-this.width/2)*this.wallWidth,(r-(this.height-1)/2)*this.wallHeight),c.setScale(a,h);var d=2*((r+l)%2-.5);this.setWall(c,u,d),this.wallSpList[r][l]={node:c,type:u,kSign:d},l<this.width&&(this.symbolSpList[r][l]=null)}}this.border={left:this.wallSpList[0][0].node.position.x+.5*this.node.parent.width-.5*this.wallWidth,right:this.wallSpList[0][this.width].node.position.x+.5*this.node.parent.width+.5*this.wallWidth,top:this.wallSpList[this.height-1][0].node.position.y+.5*this.node.parent.height+.5*this.wallHeight+this.node.getPosition().y,bottom:this.wallSpList[0][0].node.position.y+.5*this.node.parent.height-.5*this.wallHeight+this.node.getPosition().y},this.node.width=this.border.right-this.border.left,this.node.height=this.border.top-this.border.bottom},render:function(t,i){this.renderWall(t),this.renderSymbol(i)},renderWall:function(t){for(var i=0;i<this.height;i++)for(var s=0;s<this.width+1;s++){var e=void 0;e=0===s?"E":t[i][s-1]?"O":"C";var n=void 0;n=s===this.width?"E":t[i][s]?"O":"C";var o=this.wallSpList[i][s],h=o.node,a=o.type,r=o.kSign;a!==e+n&&this.setWall(h,e+n,r)}},renderSymbol:function(t){for(var i=0;i<this.height;i++)for(var s=0;s<this.width;s++){var e=this.symbolSpList[i][s],o=t[i][s];if(e)o===n.NULL?(this.rmSymbol(e.node),this.symbolSpList[i][s]=null):e.symbol!==o&&(this.setSymbol(e.node,o),this.symbolSpList[i][s]={symbol:o,node:e.node});else if(o!==n.NULL){var h=this.symbolPool.get();null===h&&(h=new cc.Node(cc.Sprite)).addComponent(cc.Sprite),h.parent=this.node;var a=(s-(this.width-1)/2)*this.wallWidth,r=(i-(this.height-1)/2)*this.wallHeight+.4*(.5-(i+s)%2)*this.wallHeight;h.setPosition(a,r),h.setScale(this.symbolScale),this.setSymbol(h,o),this.symbolSpList[i][s]={symbol:o,node:h}}}},setWall:function(t,i,s){var n=1,o=1;if(void 0===e[i]){if(i="".concat(i[1]).concat(i[0]),void 0===e[i])return!1;n=-1,o=-1}-1===s&&(o*=-1),t.getComponent(cc.Sprite).spriteFrame=this.wallSF[e[i]];var h=n*Math.abs(t.scaleX),a=o*Math.abs(t.scaleY);t.setScale(h,a)},setSymbol:function(t,i){i>=0&&(t.getComponent(cc.Sprite).spriteFrame=this.symbolSF[i])},rmSymbol:function(t){this.symbolPool.put(t)},onMouseDown:function(t){var i=this;if(this.game.status.isRun()||this.game.status.isReady()){var s=t.getLocation().x,e=t.getLocation().y,n=this.findClickPos(s,e);if(null!==n){var o=t.getButton();o===cc.Event.EventMouse.BUTTON_RIGHT?this.game.onGroundRightClick(n):o===cc.Event.EventMouse.BUTTON_LEFT&&(this.leftClickHandler?(clearTimeout(this.leftClickHandler),this.leftClickHandler=null,this.game.onGroundLeftDoubleClick(n)):this.leftClickHandler=setTimeout(function(){i.leftClickHandler=null,i.game.onGroundLeftClick(n)},200))}}},findClickWall:function(t,i){return{x:Math.floor((t-this.border.left)/this.wallWidth),y:Math.floor((i-this.border.bottom)/this.wallHeight)}},findClickPos:function(t,i){var s=this.findClickWall(t,i),e=this.calWallBorder(s.x,s.y),n=t-e.left,o=i-e.bottom,h=0;h=(s.x+s.y)%2?Number(.6*o>n):Number(n+.6*o<this.wallWidth);var a=s.x-h;return-1===a||a===this.width?null:{x:a,y:s.y}},calWallBorder:function(t,i){return{left:t*this.wallWidth+this.border.left,right:(t+1)*this.wallWidth+this.border.left,top:(i+1)*this.wallHeight+this.border.bottom,bottom:i*this.wallHeight+this.border.bottom}}}),cc._RF.pop()},{}],Status:[function(t,i,s){"use strict";cc._RF.push(i,"97e3eGjXM9FsrGXcOAs0OoG","Status");var e=0,n=1,o=2,h=3,a=4;cc.Class({extends:cc.Component,properties:{},onLoad:function(){this.stack=[],this.status=e},isReady:function(){return this.status===e},isRun:function(){return this.status===n},pause:function(){this.stack.push(this.status),this.status=o},resume:function(){this.status=this.stack.pop()},setReady:function(){this.status=e},setRun:function(){this.status=n},setFail:function(){this.status=h},setSucc:function(){this.status=a}}),cc._RF.pop()},{}]},{},["Game","Mine","PlayGround","Status"]);